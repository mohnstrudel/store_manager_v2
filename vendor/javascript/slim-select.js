// slim-select@2.12.1 downloaded from https://ga.jspm.io/npm:slim-select@2.12.1/dist/slimselect.js

var t={};(function(e,s){t=s()})(0,(function(){class CssClasses{constructor(t){t||(t={});this.main=t.main||"ss-main";this.placeholder=t.placeholder||"ss-placeholder";this.values=t.values||"ss-values";this.single=t.single||"ss-single";this.max=t.max||"ss-max";this.value=t.value||"ss-value";this.valueText=t.valueText||"ss-value-text";this.valueDelete=t.valueDelete||"ss-value-delete";this.valueOut=t.valueOut||"ss-value-out";this.deselect=t.deselect||"ss-deselect";this.deselectPath=t.deselectPath||"M10,10 L90,90 M10,90 L90,10";this.arrow=t.arrow||"ss-arrow";this.arrowClose=t.arrowClose||"M10,30 L50,70 L90,30";this.arrowOpen=t.arrowOpen||"M10,70 L50,30 L90,70";this.content=t.content||"ss-content";this.openAbove=t.openAbove||"ss-open-above";this.openBelow=t.openBelow||"ss-open-below";this.search=t.search||"ss-search";this.searchHighlighter=t.searchHighlighter||"ss-search-highlight";this.searching=t.searching||"ss-searching";this.addable=t.addable||"ss-addable";this.addablePath=t.addablePath||"M50,10 L50,90 M10,50 L90,50";this.list=t.list||"ss-list";this.optgroup=t.optgroup||"ss-optgroup";this.optgroupLabel=t.optgroupLabel||"ss-optgroup-label";this.optgroupLabelText=t.optgroupLabelText||"ss-optgroup-label-text";this.optgroupActions=t.optgroupActions||"ss-optgroup-actions";this.optgroupSelectAll=t.optgroupSelectAll||"ss-selectall";this.optgroupSelectAllBox=t.optgroupSelectAllBox||"M60,10 L10,10 L10,90 L90,90 L90,50";this.optgroupSelectAllCheck=t.optgroupSelectAllCheck||"M30,45 L50,70 L90,10";this.optgroupClosable=t.optgroupClosable||"ss-closable";this.option=t.option||"ss-option";this.optionDelete=t.optionDelete||"M10,10 L90,90 M10,90 L90,10";this.highlighted=t.highlighted||"ss-highlighted";this.open=t.open||"ss-open";this.close=t.close||"ss-close";this.selected=t.selected||"ss-selected";this.error=t.error||"ss-error";this.disabled=t.disabled||"ss-disabled";this.hide=t.hide||"ss-hide"}}function t(){return Math.random().toString(36).substring(2,10)}function e(t,e){function s(t,s){return s&&t&&t.classList&&t.classList.contains(s)||s&&t&&t.dataset&&t.dataset.id&&t.dataset.id===e?t:null}function i(t,e){return t&&t!==document?s(t,e)?t:i(t.parentNode,e):null}return s(t,e)||i(t,e)}function s(t,e=50,s=false){let i;return function(...n){const l=self;const a=()=>{i=null;s||t.apply(l,n)};const o=s&&!i;clearTimeout(i);i=setTimeout(a,e);o&&t.apply(l,n)}}function i(t,e){return JSON.stringify(t)===JSON.stringify(e)}function n(t){const e=t.replace(/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,(t=>"-"+t.toLowerCase()));return t[0]===t[0].toUpperCase()?e.substring(1):e}class Optgroup{constructor(e){this.id=e.id&&e.id!==""?e.id:t();this.label=e.label||"";this.selectAll=e.selectAll!==void 0&&e.selectAll;this.selectAllText=e.selectAllText||"Select All";this.closable=e.closable||"off";this.options=[];if(e.options)for(const t of e.options)this.options.push(new Option(t))}}class Option{constructor(e){this.id=e.id&&e.id!==""?e.id:t();this.value=e.value===void 0?e.text:e.value;this.text=e.text||"";this.html=e.html||"";this.defaultSelected=e.defaultSelected!==void 0&&e.defaultSelected;this.selected=e.selected!==void 0&&e.selected;this.display=e.display===void 0||e.display;this.disabled=e.disabled!==void 0&&e.disabled;this.mandatory=e.mandatory!==void 0&&e.mandatory;this.placeholder=e.placeholder!==void 0&&e.placeholder;this.class=e.class||"";this.style=e.style||"";this.data=e.data||{}}}class Store{constructor(t,e){this.selectType="single";this.data=[];this.selectedOrder=[];this.selectType=t;this.setData(e)}validateDataArray(t){if(!Array.isArray(t))return new Error("Data must be an array");for(let e of t)if(e instanceof Optgroup||"label"in e){if(!("label"in e))return new Error("Optgroup must have a label");if("options"in e&&e.options)for(let t of e.options){const e=this.validateOption(t);if(e)return e}}else{if(!(e instanceof Option||"text"in e))return new Error("Data object must be a valid optgroup or option");{const t=this.validateOption(e);if(t)return t}}return null}validateOption(t){return"text"in t?null:new Error("Option must have a text")}partialToFullData(t){let e=[];t.forEach((t=>{if(t instanceof Optgroup||"label"in t){let s=[];"options"in t&&t.options&&t.options.forEach((t=>{s.push(new Option(t))}));s.length>0&&e.push(new Optgroup(t))}(t instanceof Option||"text"in t)&&e.push(new Option(t))}));return e}setData(t){this.data=this.partialToFullData(t);this.selectType==="single"&&this.setSelectedBy("id",this.getSelected())}getData(){return this.filter(null,true)}getDataOptions(){return this.filter(null,false)}addOption(t,e=false){if(e){let e=[new Option(t)];this.setData(e.concat(this.getData()))}else this.setData(this.getData().concat(new Option(t)))}setSelectedBy(t,e){let s=null;let i=false;const n=[];for(let l of this.data){if(l instanceof Optgroup)for(let a of l.options){s||(s=a);a.selected=!i&&e.includes(a[t]);if(a.selected){n.push(a);this.selectType==="single"&&(i=true)}}if(l instanceof Option){s||(s=l);l.selected=!i&&e.includes(l[t]);if(l.selected){n.push(l);this.selectType==="single"&&(i=true)}}}if(this.selectType==="single"&&s&&!i){s.selected=true;n.push(s)}const l=e.map((e=>{var s;return((s=n.find((s=>s[t]===e)))===null||s===void 0?void 0:s.id)||""}));this.selectedOrder=l}getSelected(){return this.getSelectedOptions().map((t=>t.id))}getSelectedValues(){return this.getSelectedOptions().map((t=>t.value))}getSelectedOptions(){return this.filter((t=>t.selected),false)}getOptgroupByID(t){for(let e of this.data)if(e instanceof Optgroup&&e.id===t)return e;return null}getOptionByID(t){let e=this.filter((e=>e.id===t),false);return e.length?e[0]:null}getSelectType(){return this.selectType}getFirstOption(){let t=null;for(let e of this.data){e instanceof Optgroup?t=e.options[0]:e instanceof Option&&(t=e);if(t)break}return t}search(t,e){t=t.trim();return t===""?this.getData():this.filter((s=>e(s,t)),true)}filter(t,e){const s=[];this.data.forEach((i=>{if(i instanceof Optgroup){let n=[];i.options.forEach((i=>{t&&!t(i)||(e?n.push(new Option(i)):s.push(new Option(i)))}));if(n.length>0){let t=new Optgroup(i);t.options=n;s.push(t)}}i instanceof Option&&(t&&!t(i)||s.push(new Option(i)))}));return s}selectedOrderOptions(t){const e=[];this.selectedOrder.forEach((s=>{const i=t.find((t=>t.id===s));i&&e.push(i)}));t.forEach((t=>{let s=false;e.forEach((e=>{t.id!==e.id||(s=true)}));s||e.push(t)}));return e}}class Render{constructor(t,e,s,i){this.store=s;this.settings=t;this.classes=e;this.callbacks=i;this.lastSelectedOption=null;this.main=this.mainDiv();this.content=this.contentDiv();this.updateClassStyles();this.updateAriaAttributes();this.settings.contentLocation&&this.settings.contentLocation.appendChild(this.content.main)}enable(){this.main.main.classList.remove(this.classes.disabled);this.content.search.input.disabled=false}disable(){this.main.main.classList.add(this.classes.disabled);this.content.search.input.disabled=true}open(){this.main.arrow.path.setAttribute("d",this.classes.arrowOpen);this.main.main.classList.add(this.settings.openPosition==="up"?this.classes.openAbove:this.classes.openBelow);this.main.main.setAttribute("aria-expanded","true");this.moveContent();const t=this.store.getSelectedOptions();if(t.length){const e=t[t.length-1].id;const s=this.content.list.querySelector('[data-id="'+e+'"]');s&&this.ensureElementInView(this.content.list,s)}}close(){this.main.main.classList.remove(this.classes.openAbove);this.main.main.classList.remove(this.classes.openBelow);this.main.main.setAttribute("aria-expanded","false");this.content.main.classList.remove(this.classes.openAbove);this.content.main.classList.remove(this.classes.openBelow);this.main.arrow.path.setAttribute("d",this.classes.arrowClose)}updateClassStyles(){this.main.main.className="";this.main.main.removeAttribute("style");this.content.main.className="";this.content.main.removeAttribute("style");this.main.main.classList.add(this.classes.main);this.content.main.classList.add(this.classes.content);if(this.settings.style!==""){this.main.main.style.cssText=this.settings.style;this.content.main.style.cssText=this.settings.style}if(this.settings.class.length)for(const t of this.settings.class)if(t.trim()!==""){this.main.main.classList.add(t.trim());this.content.main.classList.add(t.trim())}this.settings.contentPosition!=="relative"&&this.settings.contentPosition!=="fixed"||this.content.main.classList.add("ss-"+this.settings.contentPosition)}updateAriaAttributes(){var t;this.main.main.role="combobox";this.main.main.setAttribute("aria-haspopup","listbox");this.main.main.setAttribute("aria-controls",(t=this.content.main.dataset.id)!==null&&t!==void 0?t:"");this.main.main.setAttribute("aria-expanded","false");this.content.main.setAttribute("role","listbox")}mainDiv(){var t;const e=document.createElement("div");e.dataset.id=this.settings.id;e.setAttribute("aria-label",this.settings.ariaLabel);e.tabIndex=0;e.onkeydown=t=>{switch(t.key){case"ArrowUp":case"ArrowDown":this.callbacks.open();t.key==="ArrowDown"?this.highlight("down"):this.highlight("up");return false;case"Tab":this.callbacks.close();return true;case"Enter":case" ":this.callbacks.open();const e=this.content.list.querySelector("."+this.classes.highlighted);e&&e.click();return false;case"Escape":this.callbacks.close();return false}t.key.length===1&&this.callbacks.open();return true};e.onclick=t=>{this.settings.disabled||(this.settings.isOpen?this.callbacks.close():this.callbacks.open())};const s=document.createElement("div");s.classList.add(this.classes.values);e.appendChild(s);const i=document.createElement("div");i.classList.add(this.classes.deselect);const n=(t=this.store)===null||t===void 0?void 0:t.getSelectedOptions();!this.settings.allowDeselect||this.settings.isMultiple&&n&&n.length<=0?i.classList.add(this.classes.hide):i.classList.remove(this.classes.hide);i.onclick=t=>{t.stopPropagation();if(this.settings.disabled)return;let e=true;const s=this.store.getSelectedOptions();const i=[];this.callbacks.beforeChange&&(e=this.callbacks.beforeChange(i,s)===true);if(e){if(this.settings.isMultiple){this.callbacks.setSelected([],false);this.updateDeselectAll()}else{const t=this.store.getFirstOption();const e=t?t.id:"";this.callbacks.setSelected(e,false)}this.settings.closeOnSelect&&this.callbacks.close();this.callbacks.afterChange&&this.callbacks.afterChange(this.store.getSelectedOptions())}};const l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("viewBox","0 0 100 100");const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",this.classes.deselectPath);l.appendChild(a);i.appendChild(l);e.appendChild(i);const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.classList.add(this.classes.arrow);o.setAttribute("viewBox","0 0 100 100");const c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",this.classes.arrowClose);this.settings.alwaysOpen&&o.classList.add(this.classes.hide);o.appendChild(c);e.appendChild(o);return{main:e,values:s,deselect:{main:i,svg:l,path:a},arrow:{main:o,path:c}}}mainFocus(t){t!=="click"&&this.main.main.focus({preventScroll:true})}placeholder(){const t=this.store.filter((t=>t.placeholder),false);let e=this.settings.placeholderText;t.length&&(t[0].html!==""?e=t[0].html:t[0].text!==""&&(e=t[0].text));const s=document.createElement("div");s.classList.add(this.classes.placeholder);s.innerHTML=e;return s}renderValues(){if(this.settings.isMultiple){this.renderMultipleValues();this.updateDeselectAll()}else this.renderSingleValue()}renderSingleValue(){const t=this.store.filter((t=>t.selected&&!t.placeholder),false);const e=t.length>0?t[0]:null;if(e){const t=document.createElement("div");t.classList.add(this.classes.single);e.html?t.innerHTML=e.html:t.innerText=e.text;this.main.values.innerHTML=t.outerHTML}else this.main.values.innerHTML=this.placeholder().outerHTML;this.settings.allowDeselect&&t.length?this.main.deselect.main.classList.remove(this.classes.hide):this.main.deselect.main.classList.add(this.classes.hide)}renderMultipleValues(){let t=this.main.values.childNodes;let e=this.store.filter((t=>t.selected&&t.display),false);if(e.length===0){this.main.values.innerHTML=this.placeholder().outerHTML;return}{const t=this.main.values.querySelector("."+this.classes.placeholder);t&&t.remove()}if(e.length>this.settings.maxValuesShown){const t=document.createElement("div");t.classList.add(this.classes.max);t.textContent=this.settings.maxValuesMessage.replace("{number}",e.length.toString());this.main.values.innerHTML=t.outerHTML;return}{const t=this.main.values.querySelector("."+this.classes.max);t&&t.remove()}this.settings.keepOrder&&(e=this.store.selectedOrderOptions(e));let s=[];for(let i=0;i<t.length;i++){const n=t[i];const l=n.getAttribute("data-id");if(l){const t=e.filter((t=>t.id===l),false);t.length||s.push(n)}}for(const t of s){t.classList.add(this.classes.valueOut);setTimeout((()=>{this.main.values.hasChildNodes()&&this.main.values.contains(t)&&this.main.values.removeChild(t)}),100)}t=this.main.values.childNodes;for(let s=0;s<e.length;s++){let i=true;for(let n=0;n<t.length;n++)e[s].id===String(t[n].dataset.id)&&(i=false);i&&(this.settings.keepOrder||t.length===0?this.main.values.appendChild(this.multipleValue(e[s])):s===0?this.main.values.insertBefore(this.multipleValue(e[s]),t[s]):t[s-1].insertAdjacentElement("afterend",this.multipleValue(e[s])))}}multipleValue(t){const e=document.createElement("div");e.classList.add(this.classes.value);e.dataset.id=t.id;const s=document.createElement("div");s.classList.add(this.classes.valueText);s.textContent=t.text;e.appendChild(s);if(!t.mandatory){const s=document.createElement("div");s.classList.add(this.classes.valueDelete);s.setAttribute("tabindex","0");s.onclick=e=>{e.preventDefault();e.stopPropagation();if(this.settings.disabled)return;let s=true;const i=this.store.getSelectedOptions();const n=i.filter((e=>e.selected&&e.id!==t.id),true);if(!(this.settings.minSelected&&n.length<this.settings.minSelected)){this.callbacks.beforeChange&&(s=this.callbacks.beforeChange(n,i)===true);if(s){let t=[];for(const e of n){if(e instanceof Optgroup)for(const s of e.options)t.push(s.id);e instanceof Option&&t.push(e.id)}this.callbacks.setSelected(t,false);this.settings.closeOnSelect&&this.callbacks.close();this.callbacks.afterChange&&this.callbacks.afterChange(n);this.updateDeselectAll()}}};const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("viewBox","0 0 100 100");const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",this.classes.optionDelete);i.appendChild(n);s.appendChild(i);e.appendChild(s);s.onkeydown=t=>{t.key==="Enter"&&s.click()}}return e}contentDiv(){const t=document.createElement("div");t.dataset.id=this.settings.id;const e=this.searchDiv();t.appendChild(e.main);const s=this.listDiv();t.appendChild(s);return{main:t,search:e,list:s}}moveContent(){this.settings.contentPosition!=="relative"&&this.settings.openPosition!=="down"?this.settings.openPosition!=="up"?this.putContent()==="up"?this.moveContentAbove():this.moveContentBelow():this.moveContentAbove():this.moveContentBelow()}searchDiv(){const t=document.createElement("div");const e=document.createElement("input");const i=document.createElement("div");t.classList.add(this.classes.search);const n={main:t,input:e};if(!this.settings.showSearch){t.classList.add(this.classes.hide);e.readOnly=true}e.type="search";e.placeholder=this.settings.searchPlaceholder;e.tabIndex=-1;e.setAttribute("aria-label",this.settings.searchPlaceholder);e.setAttribute("autocapitalize","off");e.setAttribute("autocomplete","off");e.setAttribute("autocorrect","off");e.oninput=s((t=>{this.callbacks.search(t.target.value)}),100);e.onkeydown=t=>{switch(t.key){case"ArrowUp":case"ArrowDown":t.key==="ArrowDown"?this.highlight("down"):this.highlight("up");return false;case"Tab":this.callbacks.close();return true;case"Escape":this.callbacks.close();return false;case" ":const e=this.content.list.querySelector("."+this.classes.highlighted);if(e){e.click();return false}return true;case"Enter":if(this.callbacks.addable){i.click();return false}{const t=this.content.list.querySelector("."+this.classes.highlighted);if(t){t.click();return false}}return true}return true};t.appendChild(e);if(this.callbacks.addable){i.classList.add(this.classes.addable);const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox","0 0 100 100");const s=document.createElementNS("http://www.w3.org/2000/svg","path");s.setAttribute("d",this.classes.addablePath);e.appendChild(s);i.appendChild(e);i.onclick=t=>{t.preventDefault();t.stopPropagation();if(!this.callbacks.addable)return;const e=this.content.search.input.value.trim();if(e===""){this.content.search.input.focus();return}const s=t=>{let e=new Option(t);this.callbacks.addOption(e);if(this.settings.isMultiple){let t=this.store.getSelected();t.push(e.id);this.callbacks.setSelected(t,true)}else this.callbacks.setSelected([e.id],true);this.callbacks.search("");this.settings.closeOnSelect&&setTimeout((()=>{this.callbacks.close()}),100)};const i=this.callbacks.addable(e);i!==false&&i!==void 0&&i!==null&&(i instanceof Promise?i.then((t=>{typeof t==="string"?s({text:t,value:t}):i instanceof Error?this.renderError(i.message):s(t)})):typeof i==="string"?s({text:i,value:i}):i instanceof Error?this.renderError(i.message):s(i))};t.appendChild(i);n.addable={main:i,svg:e,path:s}}return n}searchFocus(){this.content.search.input.focus()}getOptions(t=false,e=false,s=false){let i="."+this.classes.option;t&&(i+=":not(."+this.classes.placeholder+")");e&&(i+=":not(."+this.classes.disabled+")");s&&(i+=":not(."+this.classes.hide+")");return Array.from(this.content.list.querySelectorAll(i))}highlight(t){const e=this.getOptions(true,true,true);if(e.length===0)return;if(e.length===1&&!e[0].classList.contains(this.classes.highlighted)){e[0].classList.add(this.classes.highlighted);return}let s=false;for(const t of e)t.classList.contains(this.classes.highlighted)&&(s=true);if(!s)for(const t of e)if(t.classList.contains(this.classes.selected)){t.classList.add(this.classes.highlighted);break}for(let s=0;s<e.length;s++)if(e[s].classList.contains(this.classes.highlighted)){const i=e[s];i.classList.remove(this.classes.highlighted);const n=i.parentElement;if(n&&n.classList.contains(this.classes.open)){const t=n.querySelector("."+this.classes.optgroupLabel);t&&t.click()}let l=e[t==="down"?s+1<e.length?s+1:0:s-1>=0?s-1:e.length-1];l.classList.add(this.classes.highlighted);this.ensureElementInView(this.content.list,l);const a=l.parentElement;if(a&&a.classList.contains(this.classes.close)){const t=a.querySelector("."+this.classes.optgroupLabel);t&&t.click()}return}e[t==="down"?0:e.length-1].classList.add(this.classes.highlighted);this.ensureElementInView(this.content.list,e[t==="down"?0:e.length-1])}listDiv(){const t=document.createElement("div");t.classList.add(this.classes.list);return t}renderError(t){this.content.list.innerHTML="";const e=document.createElement("div");e.classList.add(this.classes.error);e.textContent=t;this.content.list.appendChild(e)}renderSearching(){this.content.list.innerHTML="";const t=document.createElement("div");t.classList.add(this.classes.searching);t.textContent=this.settings.searchingText;this.content.list.appendChild(t)}renderOptions(t){this.content.list.innerHTML="";if(t.length===0){const t=document.createElement("div");t.classList.add(this.classes.search);this.callbacks.addable?t.innerHTML=this.settings.addableText.replace("{value}",this.content.search.input.value):t.innerHTML=this.settings.searchText;this.content.list.appendChild(t);return}if(this.settings.allowDeselect&&!this.settings.isMultiple){const t=this.store.filter((t=>t.placeholder),false);t.length||this.store.addOption(new Option({text:"",value:"",selected:false,placeholder:true}),true)}const e=document.createDocumentFragment();for(const s of t){if(s instanceof Optgroup){const t=document.createElement("div");t.classList.add(this.classes.optgroup);const i=document.createElement("div");i.classList.add(this.classes.optgroupLabel);t.appendChild(i);const n=document.createElement("div");n.classList.add(this.classes.optgroupLabelText);n.textContent=s.label;i.appendChild(n);const l=document.createElement("div");l.classList.add(this.classes.optgroupActions);i.appendChild(l);if(this.settings.isMultiple&&s.selectAll){const t=document.createElement("div");t.classList.add(this.classes.optgroupSelectAll);let e=true;for(const t of s.options)if(!t.selected){e=false;break}e&&t.classList.add(this.classes.selected);const i=document.createElement("span");i.textContent=s.selectAllText;t.appendChild(i);const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("viewBox","0 0 100 100");t.appendChild(n);const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",this.classes.optgroupSelectAllBox);n.appendChild(a);const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",this.classes.optgroupSelectAllCheck);n.appendChild(o);t.addEventListener("click",(t=>{t.preventDefault();t.stopPropagation();const i=this.store.getSelected();if(e){const t=i.filter((t=>{for(const e of s.options)if(t===e.id)return false;return true}));this.callbacks.setSelected(t,true)}else{const t=i.concat(s.options.map((t=>t.id)));for(const t of s.options)this.store.getOptionByID(t.id)||this.callbacks.addOption(t);this.callbacks.setSelected(t,true)}}));l.appendChild(t)}if(s.closable!=="off"){const e=document.createElement("div");e.classList.add(this.classes.optgroupClosable);const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("viewBox","0 0 100 100");n.classList.add(this.classes.arrow);e.appendChild(n);const a=document.createElementNS("http://www.w3.org/2000/svg","path");n.appendChild(a);if(s.options.some((t=>t.selected))||this.content.search.input.value.trim()!==""){e.classList.add(this.classes.open);a.setAttribute("d",this.classes.arrowOpen)}else if(s.closable==="open"){t.classList.add(this.classes.open);a.setAttribute("d",this.classes.arrowOpen)}else if(s.closable==="close"){t.classList.add(this.classes.close);a.setAttribute("d",this.classes.arrowClose)}i.addEventListener("click",(e=>{e.preventDefault();e.stopPropagation();if(t.classList.contains(this.classes.close)){t.classList.remove(this.classes.close);t.classList.add(this.classes.open);a.setAttribute("d",this.classes.arrowOpen)}else{t.classList.remove(this.classes.open);t.classList.add(this.classes.close);a.setAttribute("d",this.classes.arrowClose)}}));l.appendChild(e)}t.appendChild(i);for(const i of s.options){t.appendChild(this.option(i));e.appendChild(t)}}s instanceof Option&&e.appendChild(this.option(s))}this.content.list.appendChild(e)}option(t){if(t.placeholder){const t=document.createElement("div");t.classList.add(this.classes.option);t.classList.add(this.classes.hide);return t}const e=document.createElement("div");e.dataset.id=t.id;e.classList.add(this.classes.option);e.setAttribute("role","option");t.class&&t.class.split(" ").forEach((t=>{e.classList.add(t)}));t.style&&(e.style.cssText=t.style);this.settings.searchHighlight&&this.content.search.input.value.trim()!==""?e.innerHTML=this.highlightText(t.html!==""?t.html:t.text,this.content.search.input.value,this.classes.searchHighlighter):t.html!==""?e.innerHTML=t.html:e.textContent=t.text;this.settings.showOptionTooltips&&e.textContent&&e.setAttribute("title",e.textContent);t.display||e.classList.add(this.classes.hide);t.disabled&&e.classList.add(this.classes.disabled);t.selected&&this.settings.hideSelected&&e.classList.add(this.classes.hide);if(t.selected){e.classList.add(this.classes.selected);e.setAttribute("aria-selected","true");this.main.main.setAttribute("aria-activedescendant",e.id)}else{e.classList.remove(this.classes.selected);e.setAttribute("aria-selected","false")}e.addEventListener("click",(e=>{e.preventDefault();e.stopPropagation();const s=this.store.getSelected();const i=e.currentTarget;const n=String(i.dataset.id);if(t.disabled||t.selected&&!this.settings.allowDeselect)return;if(this.settings.isMultiple&&this.settings.maxSelected<=s.length&&!t.selected||this.settings.isMultiple&&this.settings.minSelected>=s.length&&t.selected)return;let l=false;const a=this.store.getSelectedOptions();let o=[];if(this.settings.isMultiple)if(t.selected)o=a.filter((t=>t.id!==n));else{o=a.concat(t);if(!this.settings.closeOnSelect)if(e.shiftKey&&this.lastSelectedOption){const e=this.store.getDataOptions();let s=e.findIndex((t=>t.id===this.lastSelectedOption.id));let i=e.findIndex((e=>e.id===t.id));if(s>=0&&i>=0){const t=Math.min(s,i);const n=Math.max(s,i);const l=e.slice(t,n+1);l.length>0&&l.length<this.settings.maxSelected&&(o=a.concat(l.filter((t=>!a.find((e=>e.id===t.id))))))}}else t.selected||(this.lastSelectedOption=t)}this.settings.isMultiple||(o=t.selected?[]:[t]);this.callbacks.beforeChange||(l=true);this.callbacks.beforeChange&&(l=this.callbacks.beforeChange(o,a)!==false);if(l){this.store.getOptionByID(n)||this.callbacks.addOption(t);this.callbacks.setSelected(o.map((t=>t.id)),false);this.settings.closeOnSelect&&this.callbacks.close();this.callbacks.afterChange&&this.callbacks.afterChange(o)}}));return e}destroy(){this.main.main.remove();this.content.main.remove()}highlightText(t,e,s){let i=t;const n=new RegExp("(?![^<]*>)("+e.trim()+")(?![^<]*>[^<>]*</)","i");if(!t.match(n))return t;const l=t.match(n).index;const a=l+t.match(n)[0].toString().length;const o=t.substring(l,a);i=i.replace(n,`<mark class="${s}">${o}</mark>`);return i}moveContentAbove(){const t=this.main.main.offsetHeight;const e=this.content.main.offsetHeight;this.main.main.classList.remove(this.classes.openBelow);this.main.main.classList.add(this.classes.openAbove);this.content.main.classList.remove(this.classes.openBelow);this.content.main.classList.add(this.classes.openAbove);const s=this.main.main.getBoundingClientRect();this.content.main.style.margin="-"+(t+e-1)+"px 0px 0px 0px";this.content.main.style.top=s.top+s.height+(this.settings.contentPosition==="fixed"?0:window.scrollY)+"px";this.content.main.style.left=s.left+(this.settings.contentPosition==="fixed"?0:window.scrollX)+"px";this.content.main.style.width=s.width+"px"}moveContentBelow(){this.main.main.classList.remove(this.classes.openAbove);this.main.main.classList.add(this.classes.openBelow);this.content.main.classList.remove(this.classes.openAbove);this.content.main.classList.add(this.classes.openBelow);const t=this.main.main.getBoundingClientRect();this.content.main.style.margin="-1px 0px 0px 0px";if(this.settings.contentPosition!=="relative"){this.content.main.style.top=t.top+t.height+(this.settings.contentPosition==="fixed"?0:window.scrollY)+"px";this.content.main.style.left=t.left+(this.settings.contentPosition==="fixed"?0:window.scrollX)+"px";this.content.main.style.width=t.width+"px"}}ensureElementInView(t,e){const s=t.scrollTop+t.offsetTop;const i=s+t.clientHeight;const n=e.offsetTop;const l=n+e.clientHeight;n<s?t.scrollTop-=s-n:l>i&&(t.scrollTop+=l-i)}putContent(){const t=this.main.main.offsetHeight;const e=this.main.main.getBoundingClientRect();const s=this.content.main.offsetHeight;const i=window.innerHeight-(e.top+t);return i<=s&&e.top>s?"up":"down"}updateDeselectAll(){if(!this.store||!this.settings)return;const t=this.store.getSelectedOptions();const e=t&&t.length>0;const s=this.settings.isMultiple;const i=this.settings.allowDeselect;const n=this.main.deselect.main;const l=this.classes.hide;!i||s&&!e?n.classList.add(l):n.classList.remove(l)}}class Select{constructor(t){this.listen=false;this.observer=null;this.select=t;this.valueChange=this.valueChange.bind(this);this.select.addEventListener("change",this.valueChange,{passive:true});this.observer=new MutationObserver(this.observeCall.bind(this));this.changeListen(true)}enable(){this.select.disabled=false}disable(){this.select.disabled=true}hideUI(){this.select.tabIndex=-1;this.select.style.display="none";this.select.setAttribute("aria-hidden","true")}showUI(){this.select.removeAttribute("tabindex");this.select.style.display="";this.select.removeAttribute("aria-hidden")}changeListen(t){this.listen=t;t&&this.observer&&this.observer.observe(this.select,{subtree:true,childList:true,attributes:true});t||this.observer&&this.observer.disconnect()}valueChange(t){this.listen&&this.onValueChange&&this.onValueChange(this.getSelectedOptions());return true}observeCall(t){if(!this.listen)return;let e=false;let s=false;let i=false;for(const n of t){if(n.target===this.select){n.attributeName==="disabled"&&(s=true);n.attributeName==="class"&&(e=true);if(n.type==="childList"){for(const t of n.addedNodes)if(t.nodeName==="OPTION"&&t.value===this.select.value){this.select.dispatchEvent(new Event("change"));break}i=true}}n.target.nodeName!=="OPTGROUP"&&n.target.nodeName!=="OPTION"||(i=true)}e&&this.onClassChange&&this.onClassChange(this.select.className.split(" "));if(s&&this.onDisabledChange){this.changeListen(false);this.onDisabledChange(this.select.disabled);this.changeListen(true)}if(i&&this.onOptionsChange){this.changeListen(false);this.onOptionsChange(this.getData());this.changeListen(true)}}getData(){let t=[];const e=this.select.childNodes;for(const s of e){s.nodeName==="OPTGROUP"&&t.push(this.getDataFromOptgroup(s));s.nodeName==="OPTION"&&t.push(this.getDataFromOption(s))}return t}getDataFromOptgroup(t){let e={id:t.id,label:t.label,selectAll:!!t.dataset&&t.dataset.selectall==="true",selectAllText:t.dataset?t.dataset.selectalltext:"Select all",closable:t.dataset?t.dataset.closable:"off",options:[]};const s=t.childNodes;for(const t of s)t.nodeName==="OPTION"&&e.options.push(this.getDataFromOption(t));return e}getDataFromOption(t){return{id:t.id,value:t.value,text:t.text,html:t.dataset&&t.dataset.html?t.dataset.html:"",defaultSelected:t.defaultSelected,selected:t.selected,display:t.style.display!=="none",disabled:t.disabled,mandatory:!!t.dataset&&t.dataset.mandatory==="true",placeholder:t.dataset.placeholder==="true",class:t.className,style:t.style.cssText,data:t.dataset}}getSelectedOptions(){let t=[];const e=this.select.childNodes;for(const s of e){if(s.nodeName==="OPTGROUP"){const e=s.childNodes;for(const s of e)if(s.nodeName==="OPTION"){const e=s;e.selected&&t.push(this.getDataFromOption(e))}}if(s.nodeName==="OPTION"){const e=s;e.selected&&t.push(this.getDataFromOption(e))}}return t}getSelectedValues(){return this.getSelectedOptions().map((t=>t.value))}setSelected(t){this.changeListen(false);const e=this.select.childNodes;for(const s of e){if(s.nodeName==="OPTGROUP"){const e=s;const i=e.childNodes;for(const e of i)if(e.nodeName==="OPTION"){const s=e;s.selected=t.includes(s.id)}}if(s.nodeName==="OPTION"){const e=s;e.selected=t.includes(e.id)}}this.changeListen(true)}setSelectedByValue(t){this.changeListen(false);const e=this.select.childNodes;for(const s of e){if(s.nodeName==="OPTGROUP"){const e=s;const i=e.childNodes;for(const e of i)if(e.nodeName==="OPTION"){const s=e;s.selected=t.includes(s.value)}}if(s.nodeName==="OPTION"){const e=s;e.selected=t.includes(e.value)}}this.changeListen(true)}updateSelect(t,e,s){this.changeListen(false);t&&(this.select.dataset.id=t);e&&(this.select.style.cssText=e);if(s){this.select.className="";s.forEach((t=>{t.trim()!==""&&this.select.classList.add(t.trim())}))}this.changeListen(true)}updateOptions(t){this.changeListen(false);this.select.innerHTML="";for(const e of t){e instanceof Optgroup&&this.select.appendChild(this.createOptgroup(e));e instanceof Option&&this.select.appendChild(this.createOption(e))}this.select.dispatchEvent(new Event("change",{bubbles:true}));this.changeListen(true)}createOptgroup(t){const e=document.createElement("optgroup");e.id=t.id;e.label=t.label;t.selectAll&&(e.dataset.selectAll="true");t.closable!=="off"&&(e.dataset.closable=t.closable);if(t.options)for(const s of t.options)e.appendChild(this.createOption(s));return e}createOption(t){const e=document.createElement("option");e.id=t.id;e.value=t.value;e.textContent=t.text;t.html!==""&&e.setAttribute("data-html",t.html);e.defaultSelected=t.defaultSelected;e.selected=t.selected;t.disabled&&(e.disabled=true);t.display||(e.style.display="none");t.placeholder&&e.setAttribute("data-placeholder","true");t.mandatory&&e.setAttribute("data-mandatory","true");t.class&&t.class.split(" ").forEach((t=>{e.classList.add(t)}));t.data&&typeof t.data==="object"&&Object.keys(t.data).forEach((s=>{e.setAttribute("data-"+n(s),t.data[s])}));return e}destroy(){this.changeListen(false);this.select.removeEventListener("change",this.valueChange);if(this.observer){this.observer.disconnect();this.observer=null}delete this.select.dataset.id;this.showUI()}}class Settings{constructor(e){this.id="";this.style="";this.class=[];this.isMultiple=false;this.isOpen=false;this.isFullOpen=false;this.intervalMove=null;e||(e={});this.id="ss-"+t();this.style=e.style||"";this.class=e.class||[];this.disabled=e.disabled!==void 0&&e.disabled;this.alwaysOpen=e.alwaysOpen!==void 0&&e.alwaysOpen;this.showSearch=e.showSearch===void 0||e.showSearch;this.focusSearch=e.focusSearch===void 0||e.focusSearch;this.ariaLabel=e.ariaLabel||"Combobox";this.searchPlaceholder=e.searchPlaceholder||"Search";this.searchText=e.searchText||"No Results";this.searchingText=e.searchingText||"Searching...";this.searchHighlight=e.searchHighlight!==void 0&&e.searchHighlight;this.closeOnSelect=e.closeOnSelect===void 0||e.closeOnSelect;this.contentLocation=e.contentLocation||document.body;this.contentPosition=e.contentPosition||"absolute";this.openPosition=e.openPosition||"auto";this.placeholderText=e.placeholderText!==void 0?e.placeholderText:"Select Value";this.allowDeselect=e.allowDeselect!==void 0&&e.allowDeselect;this.hideSelected=e.hideSelected!==void 0&&e.hideSelected;this.keepOrder=e.keepOrder!==void 0&&e.keepOrder;this.showOptionTooltips=e.showOptionTooltips!==void 0&&e.showOptionTooltips;this.minSelected=e.minSelected||0;this.maxSelected=e.maxSelected||1e3;this.timeoutDelay=e.timeoutDelay||200;this.maxValuesShown=e.maxValuesShown||20;this.maxValuesMessage=e.maxValuesMessage||"{number} selected";this.addableText=e.addableText||'Press "Enter" to add {value}'}}class SlimSelect{constructor(t){var i;this.events={search:void 0,searchFilter:(t,e)=>t.text.toLowerCase().indexOf(e.toLowerCase())!==-1,addable:void 0,beforeChange:void 0,afterChange:void 0,beforeOpen:void 0,afterOpen:void 0,beforeClose:void 0,afterClose:void 0};this.windowResize=s((()=>{(this.settings.isOpen||this.settings.isFullOpen)&&this.render.moveContent()}));this.windowScroll=s((()=>{(this.settings.isOpen||this.settings.isFullOpen)&&this.render.moveContent()}));this.documentClick=t=>{this.settings.isOpen&&t.target&&!e(t.target,this.settings.id)&&this.close(t.type)};this.windowVisibilityChange=()=>{document.hidden&&this.close()};this.selectEl=typeof t.select==="string"?document.querySelector(t.select):t.select;if(!this.selectEl){t.events&&t.events.error&&t.events.error(new Error("Could not find select element"));return}if(this.selectEl.tagName!=="SELECT"){t.events&&t.events.error&&t.events.error(new Error("Element isnt of type select"));return}this.selectEl.dataset.ssid&&this.destroy();this.settings=new Settings(t.settings);this.cssClasses=new CssClasses(t.cssClasses);const n=["afterChange","beforeOpen","afterOpen","beforeClose","afterClose"];for(const e in t.events)t.events.hasOwnProperty(e)&&(n.indexOf(e)!==-1?this.events[e]=s(t.events[e],100):this.events[e]=t.events[e]);this.settings.disabled=((i=t.settings)===null||i===void 0?void 0:i.disabled)?t.settings.disabled:this.selectEl.disabled;this.settings.isMultiple=this.selectEl.multiple;this.settings.style=this.selectEl.style.cssText;this.settings.class=this.selectEl.className.split(" ");this.select=new Select(this.selectEl);this.select.updateSelect(this.settings.id,this.settings.style,this.settings.class);this.select.hideUI();this.select.onValueChange=t=>{this.setSelected(t.map((t=>t.id)))};this.select.onClassChange=t=>{this.settings.class=t;this.render.updateClassStyles()};this.select.onDisabledChange=t=>{t?this.disable():this.enable()};this.select.onOptionsChange=t=>{this.setData(t)};this.store=new Store(this.settings.isMultiple?"multiple":"single",t.data?t.data:this.select.getData());t.data&&this.select.updateOptions(this.store.getData());const l={open:this.open.bind(this),close:this.close.bind(this),addable:this.events.addable?this.events.addable:void 0,setSelected:this.setSelected.bind(this),addOption:this.addOption.bind(this),search:this.search.bind(this),beforeChange:this.events.beforeChange,afterChange:this.events.afterChange};this.render=new Render(this.settings,this.cssClasses,this.store,l);this.render.renderValues();this.render.renderOptions(this.store.getData());const a=this.selectEl.getAttribute("aria-label");const o=this.selectEl.getAttribute("aria-labelledby");a?this.render.main.main.setAttribute("aria-label",a):o&&this.render.main.main.setAttribute("aria-labelledby",o);this.selectEl.parentNode&&this.selectEl.parentNode.insertBefore(this.render.main.main,this.selectEl.nextSibling);window.addEventListener("resize",this.windowResize,false);this.settings.openPosition==="auto"&&window.addEventListener("scroll",this.windowScroll,false);document.addEventListener("visibilitychange",this.windowVisibilityChange);this.settings.disabled&&this.disable();this.settings.alwaysOpen&&this.open();this.selectEl.slim=this}enable(){this.settings.disabled=false;this.select.enable();this.render.enable()}disable(){this.settings.disabled=true;this.select.disable();this.render.disable()}getData(){return this.store.getData()}setData(t){const e=this.store.getSelected();const s=this.store.validateDataArray(t);if(s){this.events.error&&this.events.error(s);return}this.store.setData(t);const n=this.store.getData();this.select.updateOptions(n);this.render.renderValues();this.render.renderOptions(n);this.events.afterChange&&!i(e,this.store.getSelected())&&this.events.afterChange(this.store.getSelectedOptions())}getSelected(){let t=this.store.getSelectedOptions();this.settings.keepOrder&&(t=this.store.selectedOrderOptions(t));return t.map((t=>t.value))}setSelected(t,e=true){const s=this.store.getSelected();const n=this.store.getDataOptions();t=Array.isArray(t)?t:[t];const l=[];for(const e of t)if(n.find((t=>t.id==e)))l.push(e);else for(const t of n.filter((t=>t.value==e)))l.push(t.id);this.store.setSelectedBy("id",l);const a=this.store.getData();this.select.updateOptions(a);this.render.renderValues();this.render.content.search.input.value!==""?this.search(this.render.content.search.input.value):this.render.renderOptions(a);e&&this.events.afterChange&&!i(s,this.store.getSelected())&&this.events.afterChange(this.store.getSelectedOptions())}addOption(t){const e=this.store.getSelected();this.store.getDataOptions().some((e=>{var s;return e.value===((s=t.value)!==null&&s!==void 0?s:t.text)}))||this.store.addOption(t);const s=this.store.getData();this.select.updateOptions(s);this.render.renderValues();this.render.renderOptions(s);this.events.afterChange&&!i(e,this.store.getSelected())&&this.events.afterChange(this.store.getSelectedOptions())}open(){if(!this.settings.disabled&&!this.settings.isOpen){this.events.beforeOpen&&this.events.beforeOpen();this.render.open();this.settings.showSearch&&this.settings.focusSearch&&this.render.searchFocus();this.settings.isOpen=true;setTimeout((()=>{this.events.afterOpen&&this.events.afterOpen();this.settings.isOpen&&(this.settings.isFullOpen=true);document.addEventListener("click",this.documentClick)}),this.settings.timeoutDelay);if(this.settings.contentPosition==="absolute"){this.settings.intervalMove&&clearInterval(this.settings.intervalMove);this.settings.intervalMove=setInterval(this.render.moveContent.bind(this.render),500)}}}close(t=null){if(this.settings.isOpen&&!this.settings.alwaysOpen){this.events.beforeClose&&this.events.beforeClose();this.render.close();this.render.content.search.input.value!==""&&this.search("");this.render.mainFocus(t);this.settings.isOpen=false;this.settings.isFullOpen=false;setTimeout((()=>{this.events.afterClose&&this.events.afterClose();document.removeEventListener("click",this.documentClick)}),this.settings.timeoutDelay);this.settings.intervalMove&&clearInterval(this.settings.intervalMove)}}search(t){this.render.content.search.input.value!==t&&(this.render.content.search.input.value=t);if(!this.events.search){this.render.renderOptions(t===""?this.store.getData():this.store.search(t,this.events.searchFilter));return}this.render.renderSearching();const e=this.events.search(t,this.store.getSelectedOptions());e instanceof Promise?e.then((t=>{this.render.renderOptions(this.store.partialToFullData(t))})).catch((t=>{this.render.renderError(typeof t==="string"?t:t.message)})):Array.isArray(e)?this.render.renderOptions(this.store.partialToFullData(e)):this.render.renderError("Search event must return a promise or an array of data")}destroy(){document.removeEventListener("click",this.documentClick);window.removeEventListener("resize",this.windowResize,false);this.settings.openPosition==="auto"&&window.removeEventListener("scroll",this.windowScroll,false);document.removeEventListener("visibilitychange",this.windowVisibilityChange);this.store.setData([]);this.render.destroy();this.select.destroy()}}return SlimSelect}));var e=t;export{e as default};

